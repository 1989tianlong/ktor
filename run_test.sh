#!/usr/bin/env bash
OUT_NAME=run_test
OPTS="-XX:+UnlockDiagnosticVMOptions -XX:-UseCompressedOops -XX:PrintAssemblyOptions=intel"
OPTS="$OPTS -XX:+PrintInlining"
OPTS="$OPTS -XX:+PrintCompilation"
OPTS="$OPTS -XX:+PrintAssembly"
#OPTS="$OPTS -XX:+TraceClassLoading"
OPTS="$OPTS -XX:+LogCompilation -XX:LogFile=$OUT_NAME.log"
#OPTS="$OPTS -XX:-BackgroundCompilation"
OPTS="$OPTS -XX:CompileCommand=dontinline,*.resumeAnyThread"
OPTS="$OPTS -XX:CompileCommand=dontinline,*IOThread.await"
OPTS="$OPTS -XX:CompileCommand=dontinline,*AtomicLog.invoke"

#/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/bin/java $OPTS -Didea.test.cyclic.buffer.size=1048576 "-javaagent:/Users/jetbrains/Library/Application Support/JetBrains/Toolbox/apps/IDEA-U/ch-0/173.4548.28/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=51144:/Users/jetbrains/Library/Application Support/JetBrains/Toolbox/apps/IDEA-U/ch-0/173.4548.28/IntelliJ IDEA.app/Contents/bin" -Dfile.encoding=UTF-8 -classpath "/Users/jetbrains/Library/Application Support/JetBrains/Toolbox/apps/IDEA-U/ch-0/173.4548.28/IntelliJ IDEA.app/Contents/lib/idea_rt.jar:/Users/jetbrains/Library/Application Support/JetBrains/Toolbox/apps/IDEA-U/ch-0/173.4548.28/IntelliJ IDEA.app/Contents/plugins/junit/lib/junit-rt.jar:/Users/jetbrains/Library/Application Support/JetBrains/Toolbox/apps/IDEA-U/ch-0/173.4548.28/IntelliJ IDEA.app/Contents/plugins/junit/lib/junit5-rt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/charsets.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/deploy.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/cldrdata.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/dnsns.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/jaccess.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/jfxrt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/localedata.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/nashorn.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/sunec.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/sunjce_provider.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/sunpkcs11.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/ext/zipfs.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/javaws.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/jce.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/jfr.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/jfxswt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/jsse.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/management-agent.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/plugin.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/resources.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/jre/lib/rt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/lib/ant-javafx.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/lib/dt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/lib/javafx-mx.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/lib/jconsole.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/lib/packager.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/lib/sa-jdi.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_161.jdk/Contents/Home/lib/tools.jar:/Users/jetbrains/Projects/ktor/ktor-client/ktor-client-cio/build/classes/kotlin/test:/Users/jetbrains/Projects/ktor/ktor-client/ktor-client-cio/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-client/ktor-client-tests/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-client/ktor-client-core/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-server/ktor-server-jetty/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-server/ktor-server-servlet/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-server/ktor-server-host-common/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-http-cio/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-server/ktor-server-core/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-http/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-http/build/resources/main:/Users/jetbrains/Projects/ktor/ktor-network/build/classes/kotlin/main:/Users/jetbrains/Projects/ktor/ktor-utils/build/classes/java/main:/Users/jetbrains/Projects/ktor/ktor-utils/build/classes/kotlin/main:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-reflect/1.2.21/3159ff5936aa570a90050d385cb717fbb6c1723a/kotlin-reflect-1.2.21.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-jdk8/1.2.21/86407aed2dc197bd5f61d16e759c4ff43678732a/kotlin-stdlib-jdk8-1.2.21.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-jdk7/1.2.21/88bfff5aa470143a83b0bc5ec00c0be8cabd7cad/kotlin-stdlib-jdk7-1.2.21.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-jdk8/0.22.2/932ed1247db05901618c2f2a51aefd5b990835ad/kotlinx-coroutines-jdk8-0.22.2.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-io-jvm/0.0.10/e25cffcaadb49ae865669c955de52ff7b8f1688b/kotlinx-io-jvm-0.0.10.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-io/0.22.2/3ce0f7f221387ef75e9e02c4a0c9f42e67597822/kotlinx-coroutines-io-0.22.2.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-core/0.22.2/278a5ac19835d28394ba8894343becadb89dfbe0/kotlinx-coroutines-core-0.22.2.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-test-junit/1.2.21/413c5974f7b833a8915bc0708cb81d9b3a3dfc8a/kotlin-test-junit-1.2.21.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-test/1.2.21/ef7fb68f47996674ceca66f515b4cfa40981d241/kotlin-test-1.2.21.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib/1.2.21/d64187eb2d9d1521be3421aa8c6774a8625cdde8/kotlin-stdlib-1.2.21.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/ch.qos.logback/logback-classic/1.2.1/706a8b8206ead3683ec639dd270d11fd948fbb0e/logback-classic-1.2.1.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.slf4j/slf4j-api/1.7.25/da76ca59f6a57ee3102f8f9bd9cee742973efa8a/slf4j-api-1.7.25.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/com.typesafe/config/1.3.1/2cf7a6cc79732e3bdf1647d7404279900ca63eb0/config-1.3.1.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/junit/junit/4.12/2973d150c0dc1fefe998f834810d68f278ea58ec/junit-4.12.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.jetbrains/annotations/13.0/919f0dfe192fb4e063e7dacadee7f8bb9a2672a9/annotations-13.0.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.hamcrest/hamcrest-core/1.3/42a25dc3219429f0e5d060061f71acb49bf010a0/hamcrest-core-1.3.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-alpn-openjdk8-server/9.4.8.v20171121/3370deba16bfb00d168a99de201a116373092c1c/jetty-alpn-openjdk8-server-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-alpn-java-server/9.4.8.v20171121/b134e1383a80001be8c992ab7c2641328906330d/jetty-alpn-java-server-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-alpn-server/9.4.8.v20171121/fa0cdaef03105ff9d12f4f8f08784208fde72dbf/jetty-alpn-server-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty.http2/http2-server/9.4.8.v20171121/ae48c8758d6e1474fc52d0fa18b5950e6b03442c/http2-server-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-server/9.4.8.v20171121/34614bd9a29de57ef28ca31f1f2b49a412af196d/jetty-server-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-servlets/9.4.8.v20171121/f7b7f3d6be91f5e1a47b4d3ecaf286652b4d1332/jetty-servlets-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/ch.qos.logback/logback-core/1.2.1/378913dfc3c6c71e7e2a2853eff2c3e8ac27599/logback-core-1.2.1.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/javax.servlet/javax.servlet-api/3.1.0/3cd63d075497751784b2fa84be59432f4905bf7c/javax.servlet-api-3.1.0.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty.http2/http2-common/9.4.8.v20171121/4fd0ab69d558c2360f76a633d953aa6c3092047b/http2-common-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty.http2/http2-hpack/9.4.8.v20171121/1302f2fcf6373610f3c2f6122f1da3269486f9a7/http2-hpack-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-http/9.4.8.v20171121/9879d6c4e37400bf43f0cd4b3c6e34a3ba409864/jetty-http-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-io/9.4.8.v20171121/d3fe2dfa62f52ee91ff07cb359f63387e0e30b40/jetty-io-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-continuation/9.4.8.v20171121/34b64138f6589d3d32d02058fe73ec788cb981bf/jetty-continuation-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-util/9.4.8.v20171121/d6ec1a1613c7fa72aa6bf5d8c204750afbc3df3b/jetty-util-9.4.8.v20171121.jar:/Users/jetbrains/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty.alpn/alpn-api/1.1.3.v20160715/a1bf3a937f91b4c953acd13e8c9552347adc2198/alpn-api-1.1.3.v20160715.jar" com.intellij.rt.execution.junit.JUnitStarter -ideVersion5 -junit4 io.ktor.client.engine.cio.CIOPostTest,hugePost > $OUT_NAME.txt

export TEST_OPTS=$OPTS
./gradlew --no-daemon cleanTest :ktor-client:ktor-client-cio:test --tests io.ktor.client.engine.cio.CIOPostTest.hugePost > $OUT_NAME.txt
